<!doctype html>
<html class="no-js" lang="" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Place favicon.ico in the root directory -->

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="js/vendor/modernizr-2.8.3.min.js"></script>
    <script src="js/SIPml-api.js?svn=241" type="text/javascript"></script>
</head>
<body>
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->

<!-- Add your site or application content here -->
<!--<p>Hello world! This is HTML5 Boilerplate.</p>-->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/{{JQUERY_VERSION}}/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-{{JQUERY_VERSION}}.min.js"><\/script>')</script>
<script src="js/plugins.js"></script>
<script src="js/main.js"></script>

<!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='https://www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-XXXXX-X','auto');ga('send','pageview');
</script>
<script type="text/javascript">

    var oRingTone, oRingbackTone;

    function startRingTone() {
        try { ringtone.play(); }
        catch (e) { }
    }

    function stopRingTone() {
        try { ringtone.pause(); }
        catch (e) { }
    }

    function startRingbackTone() {
        try { ringbacktone.play(); }
        catch (e) { }
    }

    function stopRingbackTone() {
        try { ringbacktone.pause(); }
        catch (e) { }
    }

    var readyCallBack = function(e){
        createSipStack();
    };
    var errorCallBack = function(e){
        console.log("error while initialising the sipml5 stack");
    }
    SIPml.init(readyCallBack, errorCallBack);

    var sipStack;

    function eventsListener(e){
        if (e.type == 'started'){
            //successfully started the stack.

        }else if (e.type == 'i_new_call'){
            acceptCall(e);
        }else if (e.type == 'i_ao_request'){
            if (e.session == oSipSessionCall) {
                var iSipResponseCode = e.getSipResponseCode();
                if (iSipResponseCode == 180 || iSipResponseCode == 183) {
                    startRingbackTone();
                }
            }
        }
    }

    function createSipStack(){
        sipStack = new SIPml.Stack({
            realm: '10.216.235.113',
            impi: '0370103192',
            impu: 'sip:0370103192@bwas2.inferencecommunications.com',
            password: 'inference',
            display_name: 'kumar',
            websocket_proxy_url: 'ws://10.203.1.222:10061',
            outbound_proxy_url: 'udp://10.216.235.113:5188',
            enable_rtcweb_breaker: true,
            events_listener: {events:'*', listener: eventsListener},
            ice_servers: []
        })
    }
    sipStack.start();
    var callSession;

    function makeCall(){
        callSession = sipStack.newSession('call-audiovideo', {
            video_local: document.getElementById('video_local'),
            audio_remote: document.getElementById('audio_remote'),
            events_listener: { events: '*', listener: eventsListener}
        });
//        callSession.call('sip:0370103241@bwas2.inferencecommunications.com')
//                callSession.call('sip:0370103193@bwas2.inferencecommunications.com')
        callSession.call('sip:0370103241@10.216.235.113:5188')
    }

    function sipSendDTMF(c) {
        if (callSession && c) {
            if (callSession.dtmf(c) == 0) {
                try { document.getElementById("dtmfTone").play(); } catch (e) { }
            }
        }
    }
    function sipHangUp() {
        if (callSession) {
            callSession.hangup({ events_listener: { events: '*', listener: eventsListener } });
        }
    }

</script>

</pre>
<table style="margin: 0 auto" cellpadding="2" cellspacing="2">
    <tr>
        <td>
            <button value="1" onclick="sipSendDTMF('1')">
                1
            </button>
        </td>
        <td>
            <button value="2" onclick="sipSendDTMF('2')">
                2
            </button>
        </td>
        <td>
            <button value="3" onclick="sipSendDTMF('3');">
                3
            </button>
        </td>
    </tr>
    <tr>
        <td>
            <button value="4" onclick="sipSendDTMF('4');">
                4
            </button>
        </td>
        <td>
            <button value="5" onclick="sipSendDTMF('5');">
                5
            </button>
        </td>
        <td>
            <button value="6" onclick="sipSendDTMF('6');">
                6
            </button>
        </td>
    </tr>
    <tr>
        <td>
            <button value="7" onclick="sipSendDTMF('7');">
                7
            </button>
        </td>
        <td>
            <button value="8" onclick="sipSendDTMF('8');">
                8
            </button>
        </td>
        <td>
            <button value="9" onclick="sipSendDTMF('9');">
                9
            </button>
        </td>
    </tr>
    <tr>
        <td>
            <button value="*" onclick="sipSendDTMF('*');">
                *
            </button>
        </td>
        <td>
            <button value="0" onclick="sipSendDTMF('0');">
                0
            </button>
        </td>
        <td>
            <button value="#" onclick="sipSendDTMF('#');">
                #
            </button>
        </td>
    </tr>
    <tr>

        <td>
            <button onclick="makeCall()">
                Call
            </button>
        </td>
        <td colspan="2">
            <button onclick='sipHangUp();'>
                Hang Up
            </button>
        </td>

    </tr>
</table>

<audio id="audio_remote" autoplay="autoplay"> </audio>
<audio id="dtmfTone" src="sounds/dtmf.wav"> </audio>
<audio id="ringtone" loop src="sounds/ringtone.wav"> </audio>
<audio id="ringbacktone" loop src="sounds/ringbacktone.wav"> </audio>
</body>
</html>
